// Lamenting Globule 0.0 (Apathetic Amoeba)
// General Functions
// lg.general
// (c) 2011 Josh "CartLemmy" Merritt
// cartlemmy@gmail.com
// http://www.yibbleware.com


function copyObject(a,b){var c=typeOf(a)=="array"?[]:{};for(i in a){c[i]=a[i]}if(b){for(i in b){c[i]=b[i]}}return c};function setInnerHTML(d,a){if(a.trim()!=""){try{d.innerHTML=a}catch(e){}}};String.prototype.cleanLink=function(){return this.split(/[^\w\d\-]/).join("_")};String.prototype.repeat=function(a){return new Array(a+1).join(this)};String.prototype.regexIndexOf=function(a,b){var c=this.substring(b||0).search(a);return(c>=0)?(c+(b||0)):c};String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.ltrim=function(){return this.replace(/^\s+/,"")};String.prototype.rtrim=function(){return this.replace(/\s+$/,"")};String.prototype.text2HTML=function(){if(this==" ")return"&nbsp;";return this.replace(/^ | $/g,"&nbsp;").split(/ {2}/).join(" &nbsp;").split("\n").join("<br />")};String.prototype.hex=function(){var a="";for(var i=0;i<this.length;i++){if(this.charCodeAt(i)<=255){a+=dec2Hex(this.charCodeAt(i),2)}else{a+=("&#"+this.charCodeAt(i)+";").hex()}}return a};String.prototype.decimalPad=function(n){var s=this.split(".");if(n==0){return s[0]}if(s.length==1){s.push("0")}while(s[1].length!=n){if(s[1].length>n){s[1]=s[1].substr(0,n)}else{s[1]+="0"}}return s[0]+"."+s[1]};Number.prototype.decimalPad=function(n){return String(this).decimalPad(n)};String.prototype.safeString=function(){var b=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var d={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'};b.lastIndex=0;return b.test(this)?'"'+this.replace(b,function(a){var c=d[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+this+'"'};String.prototype.hex2bin=function(){var a="";for(var i=0;i<this.length;i+=2){a+=String.fromCharCode(hexToNibble(this.substr(i,1))<<4|hexToNibble(this.substr(i+1,1)))}return a};String.prototype.splitParams=function(){var b=0,pos=0;var e="";while((pos=this.regexIndexOf(/[\'\"]/,pos))!==-1){var f=this.substr(pos,1);pos++;e+=this.substr(b,pos-b-1);b=pos;pos=this.indexOf(f,pos);if(pos===-1)break;e+=escape(this.substr(b,pos-b));pos++;b=pos}if(b==0){return this.split(' ')}var e=e.split(' ');for(i in e){var a=e[i].split("=",2);if(a.length>1){e[i]=a[0]+"="+unescape(a[1])}}return e};String.prototype.wikify=function(a){var s=this.split(/\=\=\=\=([^\n\t]+)\=\=\=\=\n{0,1}/);for(var i=1;i<s.length;i+=2){s[i]="[subsubhead]"+s[i]+"[/subsubhead]"}s=s.join("").split(/\=\=\=([^\n\t]+)\=\=\=\n{0,1}/);for(var i=1;i<s.length;i+=2){s[i]="[subhead]"+s[i]+"[/subhead]"}s=s.join("").split(/\=\=([^\n\t]+)\=\=\n{0,1}/);for(var i=1;i<s.length;i+=2){s[i]="[head]"+s[i]+"[/head]"}s=s.join("").split(/\'\'\'\'\'([^\n\t\']+)\'\'\'\'\'/);for(var i=1;i<s.length;i+=2){s[i]="[b][i]"+s[i]+"[/i][/b]"}s=s.join("").split(/\'\'\'([^\n\t\']+)\'\'\'/);for(var i=1;i<s.length;i+=2){s[i]="[b]"+s[i]+"[/b]"}s=s.join("").split(/\'\'([^\n\t\']+)\'\'/);for(var i=1;i<s.length;i+=2){s[i]="[i]"+s[i]+"[/i]"}s=s.join("").split(/\n\:/);for(var i=1;i<s.length;i++){s[i]="\n[tab]"+s[i]}s=s.join("");s=s.split("\n----\n").join("\n[hr]");if(a){var f=["subsubhead","subhead","head","b","i","hr"];var t=["h3","h2","h1","b","i","hr"];for(var i=0;i<f.length;i++){s=s.split("["+f[i]+"]").join("<"+t[i]+">");s=s.split("[/"+f[i]+"]").join("</"+t[i]+">")}}return s};function docWidth(){return document.body.offsetWidth};function docHeight(){return document.body.offsetHeight};function urlencode(t){return escape(t).split("+").join('%2B').split("%20").join('+').split("*").join('%2A').split("/").join('%2F').split("@").join('%40')};function dec2Hex(n,l){if(!l){l=1}var h='0123456789ABCDEF';var a=new Array();for(var i=l-1;i>=0;i--){a.push(h.charAt((n>>(i*4))&15))}return a.join("")};function binaryData(d){this.data=d;this.getBit=function(a){var b=[1,2,4,8];return hexToNibble(this.data.charAt(a>>2))&b[a&3]?1:0};this.setBit=function(a,v){var b=[1,2,4,8];var c=[14,13,11,7];var i=a>>2;var v=dec2Hex((hexToNibble(this.data.charAt(i))&c[a&3])|(v?b[a&3]:0));this.data=this.data.substr(0,i)+v+this.data.substr(i+1)};this.bitLength=function(){return Math.ceil(this.data.length*4)}};function hexToNibble(a){var a=a.charCodeAt(0);if(a>=48&&a<=57){return a-48}else if(a>=65&&a<=70){return a-55}else if(a>=97&&a<=102){return a-87}return-1};function simpleHash(n,l){switch(typeOf(n)){case"array":n=n.join(",");break;case"string":break;default:n=serialize(n);break}if(!l)l=8;var c="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_";var v=[];for(var i=0;i<l;i++){v.push(0)}for(var i=0;i<n.length;i++){v[i%v.length]=(v[i%v.length]^n.charCodeAt(i))%c.length}var a="";for(var i=0;i<v.length;i++){a+=c.substr(v[i],1)}return a};function dc(t){return document.createElement(t)};function dg(b,p,t,a,c){if(b!==""&&document.getElementById(b)){return document.getElementById(b)}else{var d=document.createElement(t);if(b!==""){d.id=b}if(p){if(c){p.insertBefore(d,p.firstChild)}else{p.appendChild(d)}}recursiveSet(d,a);return d}return false};function getNodeTree(a,b,d){if(!d){d={}}if(!b){b=[]}if(a.childNodes){for(var i=0;i<a.childNodes.length;i++){var c=a.childNodes[i];b.push(c.name?c.name:String(i));d[b.join(".")]=c;d=getNodeTree(c,b,d);b.pop()}}return d};function byteArray(s){this.s=typeof(s)=="number"?("\0").repeat(s):s;this.getString=function(p,l){return this.s.substr(p,l)};this.getByte=function(p){return this.s.charCodeAt(p)&255};this.setByte=function(p,v){this.s=this.s.substr(0,p)+String.fromCharCode(v&255)+this.s.substr(p+1)}};function serverRequestInterface(e,f){this.base=f;this.requests=Array();this.ref=e;this.setRef=function(a){this.ref=a};this.setBase=function(a){this.base=a};this.request=function(a,b,c,o){if(o!==undefined){o.async=o.async===undefined?true:o.async;o.method=o.method===undefined?"POST":o.method}else{var o={async:true,method:"POST"}}if(!o.async){return this.requestObject(a,b,c,this,o)}else{this.requests.push(new this.requestObject(a,b,c,this,o))}};this.requestObject=function(a,b,c,d,o){this.newHTTPRequest=function(){if(window.XMLHttpRequest){return new XMLHttpRequest()}else if(window.ActiveXObject){return new ActiveXObject("Microsoft.XMLHTTP")}};this.ref=d.ref;this.parent=d;this.action=a;this.data="v="+urlencode(serialize(b));this.dataRaw=b;this.callback=c;this.conn=this.newHTTPRequest();if(o.async){this.conn.ob=this;this.conn.onreadystatechange=function(){switch(this.readyState){case 4:if(this.ob.callback){this.ob.callback(this,evalVars(this.responseText),this.ob)}break}}}this.conn.open(o.method,d.base+"?action="+a,o.async,o.user?o.user:undefined,o.password?o.password:undefined);this.conn.setRequestHeader("Content-type","application/x-www-form-urlencoded");this.conn.send(this.data);if(!o.async&&this.conn.readyState==4){if(this.conn.status==200){switch(o.returnType){case"body":return this.conn.responseBody;case"text":return this.conn.responseText;case"ajax":default:return evalVars(this.conn.responseText)}}}return false}};function evalVars(a){try{var b=!(/[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/.test(a.replace(/"(\\.|[^"\\])*"/g,'')))&&eval('('+a+')');return b}catch(e){return false}};function stopEvent(e){if(!e&&window.event)e=window.event;if(e){e.cancelBubble=true;if(e.preventDefault){e.preventDefault()}}return false};function unixTS(a){var b=new Date();if(a){return b.getTime()/1000}else{return Math.floor(b.getTime()/1000)}};function createAnchor(d){this.uid="anch"+unixTS()+"_"+((Math.random()*0xFFFF)|0);this.boat=d;window[this.uid]=this;this.q=[];this.doFunc=function(n){this.boat[this.q[n].f](this.q[n].p,this.boat)};this.requestAnimationFrame=function(f,p,t){this.q.push({f:f,p:p});setTimeout("document.getElementById('"+this.uid+"').ob.doFunc("+(this.q.length-1)+")",t)};this.callbackCode=function(a,p){this.q.push({f:a,p:p});return"window."+this.uid+".doFunc("+(this.q.length-1)+")"}};function getDeepRef(o,r,a){if(a===undefined)a=".";if(typeof(r)=="string"){r=r.split(a)}var n=r.shift();if(o[n]){if(r.length){return getDeepRef(o[n],r,a)}else{return o[n]}}return false};function setDeepRef(o,r,v,a){if(a===undefined)a=".";if(typeof(r)=="string"){r=r.split(a)}var n=r.shift();if(r.length){if(!o[n])o[n]={};setDeepRef(o[n],r,v,a)}else{o[n]=v}return false};function recursiveSet(d,a){for(var i in a){if(typeof(a[i])=="object"){recursiveSet(d[i],a[i])}else{d[i]=a[i]}}};function serialize(g){var h=function(a){var b=0,i=0,l=a.length,code='';for(i=0;i<l;i++){code=a.charCodeAt(i);if(code<0x0080){b+=1}else if(code<0x0800){b+=2}else{b+=3}}return b};var j=function(a){var b=typeof a,match;var c;if(b==='object'&&!a){return'null'}if(b==="object"){if(!a.constructor){return'object'}var d=a.constructor.toString();try{match=d.match(/(\w+)\(/)}catch(e){return'null'}if(match){d=match[1].toLowerCase()}var f=["boolean","number","string","array"];for(c in f){if(d==f[c]){b=f[c];break}}}return b};var k=j(g);var m,ktype='';switch(k){case"function":m="";break;case"boolean":m="b:"+(g?"1":"0");break;case"number":if(isNaN(g)){m="d:0"}else{m=(Math.round(g)==g?"i":"d")+":"+g}break;case"string":m="s:"+h(g)+":\""+g+"\"";break;case"array":case"object":m="a";var n=0;var o="";var p;var q;for(q in g){if(g.hasOwnProperty(q)){ktype=j(g[q]);if(ktype==="function"){continue}p=(q.match(/^[0-9]+$/)?parseInt(q,10):q);o+=this.serialize(p)+this.serialize(g[q]);n++}}m+=":"+n+":{"+o+"}";break;case"undefined":default:m="N";break}if(k!=="object"&&k!=="array"){m+=";"}return m};function debugObject(a,b,c,d,e){if(!d)d=0;if(!e)e="";if(!c)c=1;var f=Array(d+1).join("\t")+"("+typeOf(a)+") "+(b?b+": ":"");switch(typeOf(a)){case"null":f+="NULL";break;case"array":case"object":if(d<c){f+="\n";var g=Array();for(var i in a){if(typeof(a[i])!="function"){f+=debugObject(a[i],i,c,d+1,e)}}}else{f+="Beyond max recursion."}break;default:f+=a;break}return f+"\n"};function typeOf(a){var s=typeof a;if(s==='object'){if(a){if(a instanceof Array){s='array'}}else{s='null'}}return s};function optionDefaults(o,a){if(!o){o={}}for(var i in a){if(o[i]===undefined){o[i]=a[i]}}return o};function json_encode(j){var l,json=this.window.JSON;try{if(typeof json==='object'&&typeof json.stringify==='function'){l=json.stringify(j);if(l===undefined){throw new SyntaxError('json_encode');}return l}var m=j;var n=function(a,b){var c='';var d='    ';var i=0;var k='';var v='';var e=0;var f=c;var g=[];var h=b[a];if(h&&typeof h==='object'&&typeof h.toJSON==='function'){h=h.toJSON(a)}switch(typeof h){case'string':return h.safeString();case'number':return isFinite(h)?String(h):'null';case'boolean':case'null':return String(h);case'object':if(!h){return'null'}if((this.PHPJS_Resource&&h instanceof this.PHPJS_Resource)||(window.PHPJS_Resource&&h instanceof window.PHPJS_Resource)){throw new SyntaxError('json_encode');}c+=d;g=[];if(Object.prototype.toString.apply(h)==='[object Array]'){e=h.length;for(i=0;i<e;i+=1){g[i]=n(i,h)||'null'}v=g.length===0?'[]':c?'[\n'+c+g.join(',\n'+c)+'\n'+f+']':'['+g.join(',')+']';c=f;return v}for(k in h){if(Object.hasOwnProperty.call(h,k)){v=n(k,h);if(v){g.push(k.safeString()+(c?': ':':')+v)}}}v=g.length===0?'{}':c?'{\n'+c+g.join(',\n'+c)+'\n'+f+'}':'{'+g.join(',')+'}';c=f;return v;case'undefined':case'function':default:throw new SyntaxError('json_encode');}};return n('',{'':m})}catch(err){if(!(err instanceof SyntaxError)){throw new Error('Unexpected error type in json_encode()');}this.php_js=this.php_js||{};this.php_js.last_error_json=4;return null}};function json_decode(o){eval("o = "+o);return o};if(!Array.prototype.indexOf){Array.prototype.indexOf=function(a){"use strict";if(this===void 0||this===null)throw new TypeError();var t=Object(this);var b=t.length>>>0;if(b===0)return-1;var n=0;if(arguments.length>0){n=Number(arguments[1]);if(n!==n)n=0;else if(n!==0&&n!==(1/0)&&n!==-(1/0))n=(n>0||-1)*Math.floor(Math.abs(n))}if(n>=b)return-1;var k=n>=0?n:Math.max(b-Math.abs(n),0);for(;k<b;k++){if(k in t&&t[k]===a)return k}return-1}}function date(e,g){var h=this,jsdate,f,formatChr=/\\?([a-z])/gi,formatChrCb,_pad=function(n,c){if((n=n+'').length<c){return new Array((++c)-n.length).join('0')+n}return n},txt_words=["Sun","Mon","Tues","Wednes","Thurs","Fri","Satur","January","February","March","April","May","June","July","August","September","October","November","December"];formatChrCb=function(t,s){return f[t]?f[t]():s};f={d:function(){return _pad(f.j(),2)},D:function(){return f.l().slice(0,3)},j:function(){return jsdate.getDate()},l:function(){return txt_words[f.w()]+'day'},N:function(){return f.w()||7},S:function(){var j=f.j();return j>4||j<21?'th':{1:'st',2:'nd',3:'rd'}[j%10]||'th'},w:function(){return jsdate.getDay()},z:function(){var a=new Date(f.Y(),f.n()-1,f.j()),b=new Date(f.Y(),0,1);return Math.round((a-b)/864e5)+1},W:function(){var a=new Date(f.Y(),f.n()-1,f.j()-f.N()+3),b=new Date(a.getFullYear(),0,4);return _pad(1+Math.round((a-b)/864e5/7),2)},F:function(){return txt_words[6+f.n()]},m:function(){return _pad(f.n(),2)},M:function(){return f.F().slice(0,3)},n:function(){return jsdate.getMonth()+1},t:function(){return(new Date(f.Y(),f.n(),0)).getDate()},L:function(){return new Date(f.Y(),1,29).getMonth()===1|0},o:function(){var n=f.n(),W=f.W(),Y=f.Y();return Y+(n===12&&W<9?-1:n===1&&W>9)},Y:function(){return jsdate.getFullYear()},y:function(){return(f.Y()+"").slice(-2)},a:function(){return jsdate.getHours()>11?"pm":"am"},A:function(){return f.a().toUpperCase()},B:function(){var H=jsdate.getUTCHours()*36e2,i=jsdate.getUTCMinutes()*60,s=jsdate.getUTCSeconds();return _pad(Math.floor((H+i+s+36e2)/86.4)%1e3,3)},g:function(){return f.G()%12||12},G:function(){return jsdate.getHours()},h:function(){return _pad(f.g(),2)},H:function(){return _pad(f.G(),2)},i:function(){return _pad(jsdate.getMinutes(),2)},s:function(){return _pad(jsdate.getSeconds(),2)},u:function(){return _pad(jsdate.getMilliseconds()*1000,6)},e:function(){throw'Not supported (see source code of date() for timezone on how to add support)';},I:function(){var a=new Date(f.Y(),0),c=Date.UTC(f.Y(),0),b=new Date(f.Y(),6),d=Date.UTC(f.Y(),6);return 0+((a-c)!==(b-d))},O:function(){var a=jsdate.getTimezoneOffset();return(a>0?"-":"+")+_pad(Math.abs(a/60*100),4)},P:function(){var O=f.O();return(O.substr(0,3)+":"+O.substr(3,2))},T:function(){return'UTC'},Z:function(){return-jsdate.getTimezoneOffset()*60},c:function(){return'Y-m-d\\Th:i:sP'.replace(formatChr,formatChrCb)},r:function(){return'D, d M Y H:i:s O'.replace(formatChr,formatChrCb)},U:function(){return jsdate.getTime()/1000|0}};this.date=function(a,b){h=this;jsdate=((typeof b==='undefined')?new Date():(b instanceof Date)?new Date(b):new Date(b*1000));return a.replace(formatChr,formatChrCb)};return this.date(e,g)};function lgError(e,a){alert(a+"\n\n"+debugObject(e,"e",3))};function base64_decode(a,b){var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"+(b?"-._":"+/=");var d,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,dec="",tmp_arr=[];if(!a){return a}a+='';do{h1=c.indexOf(a.charAt(i++));h2=c.indexOf(a.charAt(i++));h3=c.indexOf(a.charAt(i++));h4=c.indexOf(a.charAt(i++));bits=h1<<18|h2<<12|h3<<6|h4;d=bits>>16&0xff;o2=bits>>8&0xff;o3=bits&0xff;if(h3==64){tmp_arr[ac++]=String.fromCharCode(d)}else if(h4==64){tmp_arr[ac++]=String.fromCharCode(d,o2)}else{tmp_arr[ac++]=String.fromCharCode(d,o2,o3)}}while(i<a.length);dec=tmp_arr.join('');return dec};function base64_encode(a,b){var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"+(b?"-._":"+/=");var d,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,enc="",tmp_arr=[];if(!a){return a}do{d=a.charCodeAt(i++);o2=a.charCodeAt(i++);o3=a.charCodeAt(i++);bits=d<<16|o2<<8|o3;h1=bits>>18&0x3f;h2=bits>>12&0x3f;h3=bits>>6&0x3f;h4=bits&0x3f;tmp_arr[ac++]=c.charAt(h1)+c.charAt(h2)+c.charAt(h3)+c.charAt(h4)}while(i<a.length);enc=tmp_arr.join('');var r=a.length%3;return(r?enc.slice(0,r-3):enc)+(b?'___':'===').slice(r||3)};